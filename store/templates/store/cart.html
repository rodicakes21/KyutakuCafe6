{% extends "store/base.html" %}
{% load static %}

{% block title %}Your Cart - Kyūtakuh's Cafē{% endblock %}

{% block content %}

<h2>Your Cart</h2>

{% if cart|length %}
    <div class="product-container">

        {% for item in cart %}
            <div class="product-card">

                {% if item.product.image %}
                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                {% else %}
                    <img src="{% static 'images/noimage.png' %}" alt="No image">
                {% endif %}

                <h3>{{ item.product.name }}</h3>

                <!-- Product price -->
                <p>₱{{ item.product.price }}</p>

                <!-- Quantity Selector -->
                <div class="quantity-box">
                    <a href="{% url 'cart_decrease' item.product.id %}" class="qty-btn">−</a>
                    <span class="qty-number">{{ item.quantity }}</span>
                    <a href="{% url 'cart_increase' item.product.id %}" class="qty-btn">+</a>
                </div>

                <p><strong>Total: ₱{{ item.total_price }}</strong></p>

                <!-- Remove -->
                <a href="{% url 'cart_remove' item.product.id %}" class="btn remove-btn">Remove</a>

            </div>
        {% endfor %}

    </div>

    <h3 style="margin-top: 30px;">Grand Total: ₱{{ cart.get_total_price }}</h3>

    <!-- CHECKOUT BUTTON WITH RESTRICTIONS -->
    {% if user.is_staff or user.is_superuser %}
        <a href="{% url 'checkout' %}" class="btn">Proceed to Checkout</a>
    {% else %}
        <a href="#" class="btn" onclick="denyCheckout()">Proceed to Checkout</a>
    {% endif %}

{% else %}
    <p>Your cart is empty.</p>
{% endif %}

<script>
function denyCheckout() {
    alert("Only staff and admin users can proceed to checkout.");
}
</script>

{% endblock %}


